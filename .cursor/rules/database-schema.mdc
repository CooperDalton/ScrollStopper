-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.image_collections (
  user_id uuid,
  name text,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT image_collections_pkey PRIMARY KEY (id),
  CONSTRAINT image_collections_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.images (
  metadata jsonb NOT NULL,
  search_tsv tsvector,
  categories ARRAY,
  objects ARRAY,
  mime_type text,
  bytes bigint,
  width integer,
  height integer,
  aspect_ratio text CHECK (aspect_ratio ~ '^[0-9]+:[0-9]+$'::text),
  user_id uuid NOT NULL,
  storage_path text NOT NULL,
  collection_id uuid,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT images_pkey PRIMARY KEY (id),
  CONSTRAINT images_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT images_collection_id_fkey FOREIGN KEY (collection_id) REFERENCES public.image_collections(id)
);
CREATE TABLE public.products (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp without time zone DEFAULT now(),
  user_id uuid,
  name text,
  description text,
  CONSTRAINT products_pkey PRIMARY KEY (id),
  CONSTRAINT products_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.slide_overlays (
  slide_id uuid,
  image_id uuid,
  position_x integer,
  position_y integer,
  rotation integer,
  size integer,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT slide_overlays_pkey PRIMARY KEY (id),
  CONSTRAINT slide_overlays_slide_id_fkey FOREIGN KEY (slide_id) REFERENCES public.slides(id),
  CONSTRAINT slide_overlays_image_id_fkey FOREIGN KEY (image_id) REFERENCES public.images(id)
);
CREATE TABLE public.slide_texts (
  slide_id uuid,
  text text,
  position_x integer,
  position_y integer,
  size integer,
  rotation integer,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  font text DEFAULT 'default'::text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT slide_texts_pkey PRIMARY KEY (id),
  CONSTRAINT slide_texts_slide_id_fkey FOREIGN KEY (slide_id) REFERENCES public.slides(id)
);
CREATE TABLE public.slides (
  index smallint NOT NULL,
  slideshow_id uuid,
  background_image_id uuid,
  duration_seconds integer,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT slides_pkey PRIMARY KEY (id),
  CONSTRAINT slides_background_image_id_fkey FOREIGN KEY (background_image_id) REFERENCES public.images(id),
  CONSTRAINT slides_slideshow_id_fkey FOREIGN KEY (slideshow_id) REFERENCES public.slideshows(id)
);
CREATE TABLE public.slideshows (
  aspect_ratio text DEFAULT '9:16'::text CHECK (aspect_ratio ~ '^[0-9]+:[0-9]+$'::text),
  date_modified timestamp without time zone DEFAULT now(),
  user_id uuid,
  product_id uuid,
  caption text,
  tik_tok_post_id text,
  frame_paths ARRAY,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  status text DEFAULT 'draft'::text,
  upload_status text DEFAULT 'pending'::text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT slideshows_pkey PRIMARY KEY (id),
  CONSTRAINT slideshows_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT slideshows_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL,
  full_name text,
  role text DEFAULT 'free'::text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);